-- phpMyAdmin SQL Dump
-- version 4.8.3
-- https://www.phpmyadmin.net/
--
-- Хост: 127.0.0.1:3306
-- Время создания: Апр 09 2019 г., 17:19
-- Версия сервера: 5.6.41
-- Версия PHP: 5.5.38

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET AUTOCOMMIT = 0;
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- База данных: `фирма`
--

DELIMITER $$
--
-- Процедуры
--
CREATE DEFINER=`root`@`%` PROCEDURE `cost_increase` (IN `price` DECIMAL(10,2), IN `stock` INT(10))  NO SQL
BEGIN
  UPDATE `товары` as t, `запасы` as s SET t.`Цена1` = t.`Цена1` + price, t.`Цена2` = t.`Цена2` + price
  WHERE t.`КодТовара` = s.`КодТовара` AND
  (SELECT SUM(ss.`Количество`)
   FROM `запасы` as ss
   WHERE ss.`КодТовара` = s.`КодТовара`) < stock;
END$$

DELIMITER ;

-- --------------------------------------------------------

--
-- Структура таблицы `контрагенты`
--

CREATE TABLE `контрагенты` (
  `КодКАгента` varchar(4) NOT NULL,
  `НаимКАгента` varchar(50) DEFAULT NULL,
  `Адрес` varchar(60) DEFAULT NULL,
  `Телефон` varchar(10) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Дамп данных таблицы `контрагенты`
--

INSERT INTO `контрагенты` (`КодКАгента`, `НаимКАгента`, `Адрес`, `Телефон`) VALUES
('0429', 'СКЛАД (Мультимедиа)', 'ул. П.И. Чайковского, 22', '333-33-05'),
('1506', 'СКЛАД (МНЕВНИКИ)', 'ул. Советская, 77', '444-33-45'),
('1518', 'СКЛАД (НЕЙРОН)', 'пр. Петровича', '324-55-45'),
('1958', 'СКЛАД (Брак)', 'пер. Симоновича', '334-33-41');

-- --------------------------------------------------------

--
-- Структура таблицы `подразделения`
--

CREATE TABLE `подразделения` (
  `КодПодразделения` varchar(4) NOT NULL,
  `НаимПодразделения` varchar(50) DEFAULT NULL,
  `Адрес` varchar(60) DEFAULT NULL,
  `Телефон` varchar(10) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Дамп данных таблицы `подразделения`
--

INSERT INTO `подразделения` (`КодПодразделения`, `НаимПодразделения`, `Адрес`, `Телефон`) VALUES
('0429', 'СКЛАД (Мультимедиа)', 'ул. П.И. Чайковского, 22', '333-33-05'),
('1506', 'СКЛАД (МНЕВНИКИ)', 'ул. Советская, 77', '444-33-45'),
('1518', 'СКЛАД (НЕЙРОН)', 'пр. Петровича', '324-55-45'),
('1958', 'СКЛАД (Брак)', 'пер. Симоновича', '334-33-41');

-- --------------------------------------------------------

--
-- Структура таблицы `запасы`
--

CREATE TABLE `запасы` (
  `КодПодразделения` varchar(4) DEFAULT NULL,
  `КодТовара` varchar(12) DEFAULT NULL,
  `Количество` int(10) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Дамп данных таблицы `запасы`
--

INSERT INTO `запасы` (`КодПодразделения`, `КодТовара`, `Количество`) VALUES
('0429', '006019165803', 3000),
('1506', '006019165803', 200),
('1518', '006019165803', 1200),
('0429', '006019170049', 1000),
('1506', '006019170049', 500),
('1518', '006019170049', 1000),
('1506', '036019164741', 600),
('1518', '036019164741', 1400),
('1506', '174500175359', 600),
('1958', '174500175359', 2200),
('0429', '174500175359', 1500),
('1958', '174500175359', 2300),
('1958', '010428144348', 4200),
('1506', '010414114438', 400),
('1958', '010414114438', 3300),
('1506', '010428144348', 800),
('0429', '036019164741', 2000),
('1958', '186100175232', 1300);

-- --------------------------------------------------------

--
-- Структура таблицы `наклзаголовки`
--

CREATE TABLE `наклзаголовки` (
  `Дата` datetime DEFAULT NULL,
  `Номер` int(10) DEFAULT NULL,
  `Код подразделения` varchar(4) DEFAULT NULL,
  `КодКАгента` varchar(4) DEFAULT NULL,
  `ТипНакладной` smallint(5) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Дамп данных таблицы `наклзаголовки`
--

INSERT INTO `наклзаголовки` (`Дата`, `Номер`, `Код подразделения`, `КодКАгента`, `ТипНакладной`) VALUES
('2002-01-11 00:00:00', 5, '1506', '1518', 2),
('2002-02-11 00:00:00', 1, '0429', '1958', 2),
('2002-01-11 00:00:00', 1, '0429', '1958', 5),
('2002-02-11 00:00:00', 2, '0429', '1506', 5),
('2002-02-11 00:00:00', 3, '0429', '1506', 5),
('2002-02-11 00:00:00', 4, '0429', '1958', 5),
('2002-03-11 00:00:00', 1, '0429', '1518', 5),
('2002-03-11 00:00:00', 2, '0429', '1958', 2),
('2002-03-11 00:00:00', 3, '0429', '1518', 5),
('2002-03-11 00:00:00', 4, '0429', '1958', 5);

-- --------------------------------------------------------

--
-- Структура таблицы `наклспецификации`
--

CREATE TABLE `наклспецификации` (
  `Дата` datetime DEFAULT NULL,
  `Номер` int(10) DEFAULT NULL,
  `КодПодразделения` varchar(4) DEFAULT NULL,
  `КодТовара` varchar(12) DEFAULT NULL,
  `Количество` int(10) DEFAULT NULL,
  `ЦенаОперации` decimal(30,11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Дамп данных таблицы `наклспецификации`
--

INSERT INTO `наклспецификации` (`Дата`, `Номер`, `КодПодразделения`, `КодТовара`, `Количество`, `ЦенаОперации`) VALUES
('2002-02-11 00:00:00', 1, '0429', '006019165803', 100, '42.00000000000'),
('2002-01-11 00:00:00', 1, '0429', '010414114438', 50, '135.00000000000'),
('2002-02-11 00:00:00', 2, '0429', '010415090732', 12, '109.00000000000'),
('2002-03-11 00:00:00', 1, '0429', '010415090732', 222, '110.00000000000'),
('2002-03-11 00:00:00', 2, '0429', '010415090732', 111, '111.00000000000'),
('2002-01-11 00:00:00', 1, '0429', '010415090937', 100, '120.00000000000'),
('2002-01-11 00:00:00', 5, '1506', '028019100222', 546, '83.00000000000'),
('2002-02-11 00:00:00', 1, '0429', '028019100222', 140, '88.00000000000'),
('2002-02-11 00:00:00', 2, '0429', '028019100222', 60, '89.00000000000'),
('2002-02-11 00:00:00', 3, '0429', '028019100222', 545, '85.00000000000'),
('2002-02-11 00:00:00', 4, '0429', '028019100222', 334, '88.00000000000'),
('2002-03-11 00:00:00', 1, '0429', '028019100222', 232, '88.00000000000'),
('2002-02-11 00:00:00', 3, '0429', '174500175359', 200, '750.00000000000'),
('2002-03-11 00:00:00', 2, '0429', '174500175359', 234, '750.00000000000'),
('2002-03-11 00:00:00', 3, '0429', '174500175359', 432, '750.00000000000'),
('2002-02-11 00:00:00', 2, '0429', '174500175521', 200, '750.00000000000'),
('2002-02-11 00:00:00', 4, '0429', '174500175521', 222, '750.00000000000'),
('2002-03-11 00:00:00', 4, '0429', '174500175521', 67, '750.00000000000'),
('2002-02-11 00:00:00', 2, '0429', '186100175232', 100, '750.00000000000'),
('2002-02-11 00:00:00', 4, '0429', '186100175232', 767, '745.00000000000'),
('2002-03-11 00:00:00', 5, '0429', '186100175232', 231, '750.00000000000');

-- --------------------------------------------------------

--
-- Структура таблицы `типынакладных`
--

CREATE TABLE `типынакладных` (
  `ТипНакладной` smallint(5) NOT NULL,
  `НаимТипа` varchar(20) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Дамп данных таблицы `типынакладных`
--

INSERT INTO `типынакладных` (`ТипНакладной`, `НаимТипа`) VALUES
(2, 'Приход со склада'),
(4, 'Приход из опт. маг.'),
(5, 'Расход на склад');

-- --------------------------------------------------------

--
-- Структура таблицы `товары`
--

CREATE TABLE `товары` (
  `КодТовара` varchar(12) NOT NULL,
  `НаимТовара` varchar(50) DEFAULT NULL,
  `Цена1` decimal(10,2) DEFAULT NULL,
  `Цена2` decimal(10,2) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Дамп данных таблицы `товары`
--

INSERT INTO `товары` (`КодТовара`, `НаимТовара`, `Цена1`, `Цена2`) VALUES
('000000000002', 'Косолапый мишка', '14.00', '16.00'),
('006019165803', '(S) Road Rash II', '46.00', '52.00'),
('006019170049', '(S) Tazmania', '35.00', '39.00'),
('010414114438', '(VCD) Патриот', '143.00', '165.00'),
('010415090732', '(VCD) Пастырь', '113.00', '131.00'),
('010415090937', '(VCD) Шоссе в никуда', '122.00', '141.00'),
('010428144348', '(VCD) Доберман', '137.00', '159.00'),
('028019095823', '(VCD) Diber Marouani', '92.00', '106.00'),
('028019100018', '(VCD) Wham The best of', '107.00', '124.00'),
('028019100222', '(VCD) Голая мишень', '92.00', '106.00'),
('036019164741', '(S) Cool Spot', '47.00', '53.00'),
('174500175359', '(3DC) Street Fighter 3 Wir', '752.00', '876.00'),
('174500175521', '(3DC) Star Gladiator 2', '752.00', '876.00'),
('186100175232', '(3DC) Super Runabout', '755.00', '879.00');

--
-- Индексы сохранённых таблиц
--

--
-- Индексы таблицы `контрагенты`
--
ALTER TABLE `контрагенты`
  ADD PRIMARY KEY (`КодКАгента`);

--
-- Индексы таблицы `подразделения`
--
ALTER TABLE `подразделения`
  ADD PRIMARY KEY (`КодПодразделения`);

--
-- Индексы таблицы `запасы`
--
ALTER TABLE `запасы`
  ADD KEY `FK_запасы_КодТовара` (`КодТовара`),
  ADD KEY `FK_запасы_КодПодразделения` (`КодПодразделения`);

--
-- Индексы таблицы `наклзаголовки`
--
ALTER TABLE `наклзаголовки`
  ADD KEY `FK_наклзаголовки_Код подразделения` (`Код подразделения`),
  ADD KEY `FK_наклзаголовки_КодКАгента` (`КодКАгента`),
  ADD KEY `FK_наклзаголовки_ТипНакладной` (`ТипНакладной`);

--
-- Индексы таблицы `наклспецификации`
--
ALTER TABLE `наклспецификации`
  ADD KEY `FK_наклспецификации_КодТовара` (`КодТовара`);

--
-- Индексы таблицы `типынакладных`
--
ALTER TABLE `типынакладных`
  ADD PRIMARY KEY (`ТипНакладной`);

--
-- Индексы таблицы `товары`
--
ALTER TABLE `товары`
  ADD PRIMARY KEY (`КодТовара`);

--
-- AUTO_INCREMENT для сохранённых таблиц
--

--
-- AUTO_INCREMENT для таблицы `типынакладных`
--
ALTER TABLE `типынакладных`
  MODIFY `ТипНакладной` smallint(5) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;

--
-- Ограничения внешнего ключа сохраненных таблиц
--

--
-- Ограничения внешнего ключа таблицы `запасы`
--
ALTER TABLE `запасы`
  ADD CONSTRAINT `FK_запасы_КодПодразделения` FOREIGN KEY (`КодПодразделения`) REFERENCES `подразделения` (`КодПодразделения`) ON DELETE NO ACTION,
  ADD CONSTRAINT `FK_запасы_КодТовара` FOREIGN KEY (`КодТовара`) REFERENCES `товары` (`КодТовара`) ON DELETE NO ACTION;

--
-- Ограничения внешнего ключа таблицы `наклзаголовки`
--
ALTER TABLE `наклзаголовки`
  ADD CONSTRAINT `FK_наклзаголовки_Код подразделения` FOREIGN KEY (`Код подразделения`) REFERENCES `подразделения` (`КодПодразделения`) ON DELETE NO ACTION,
  ADD CONSTRAINT `FK_наклзаголовки_КодКАгента` FOREIGN KEY (`КодКАгента`) REFERENCES `контрагенты` (`КодКАгента`) ON DELETE NO ACTION,
  ADD CONSTRAINT `FK_наклзаголовки_ТипНакладной` FOREIGN KEY (`ТипНакладной`) REFERENCES `типынакладных` (`ТипНакладной`) ON DELETE NO ACTION;

--
-- Ограничения внешнего ключа таблицы `наклспецификации`
--
ALTER TABLE `наклспецификации`
  ADD CONSTRAINT `FK_наклспецификации_КодТовара` FOREIGN KEY (`КодТовара`) REFERENCES `товары` (`КодТовара`) ON DELETE NO ACTION;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
